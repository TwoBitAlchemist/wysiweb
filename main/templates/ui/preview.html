{% extends 'elements/document.html' %}
{% load staticfiles %}
{% block preview_extra_headers %}
<script src="{% static 'admin/js/_djangoAjaxInit.js' %}"></script>
<script src="{% static 'admin/js/rangy/lib/rangy-core.js' %}"></script>
<script src="{% static 'admin/js/rangy/lib/rangy-classapplier.js' %}"></script>
<script src="{% static 'admin/js/rangy/lib/rangy-textrange.js' %}"></script>
<script>
var timerID;
$(document).ready(function(){
    rangy.init();
    var rangy_opts = {normalize: true, applyToEditableOnly: true};
    var wrapper = rangy.createCssClassApplier('selected', rangy_opts);
    $('.container').prop('contenteditable', true).on('mouseup', function(){
        if (timerID) window.clearTimeout(timerID);
        timerID = window.setTimeout(function(){
            var sel = rangy.getSelection();
            if (sel.toString().length > 1) {
                sel.expand('word');
                wrapper.applyToSelection();
            }
        }, 120);
    }).on('mousedown', function(){
        wrapper.undoToSelection();
    });
});
</script>
{% endblock %}
{% block preview_hidden %}
{% load mptt_tags %}
{% load wysiweb_filters %}
{% recursetree elements.all %}
<input type="hidden" value="{{ node.text }}"
    id="{{ node|elemid }}-text">
{% if not node.is_leaf_node %}
{{ children }}
{% endif %}
{% endrecursetree %}
{% endblock %}
